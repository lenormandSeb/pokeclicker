<div aria-labelledby="myModalLabel" class="modal fade noselect" id="fishingModal" role="dialog"
     style="cursor:default" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header p-0">
                <ul class="nav nav-tabs nav-fill">
                    <li class="nav-item"><a data-toggle='tab' class='nav-link active' href="#dig">Dig</a></li>
                    <li class='nav-item'>
                        <a data-toggle='tab' class='nav-link' href="#treasures">Treasures</a>
                    </li>
                    <li class='nav-item'>
                        <a data-toggle='tab' class='nav-link' href="#upgrades">Upgrades</a>
                    </li>
                    <li class='nav-item'>
                        <a data-toggle='tab' class='nav-link' href="#dailyDeals">
                            Daily deals
                        </a>
                    </li>
                    <li class='nav-item'><a data-toggle='tab' class='nav-link' href="#help">Help</a></li>
                    <btn class="btn btn-primary">
                        <span id="diamondCounter" data-bind='text: App.game.wallet.currencies[GameConstants.Currency.diamond]()'>x</span>
                        <img src='assets/images/underground/diamond.svg' width="20px'">
                    </btn>
                </ul>
            </div>
            <div class="modal-body tab-content p-0">
                <div id="fishingView" class="justify-content-center no-select row">
                    <div class="col-12 col-lg-4">
                        <ul id="seedList" class="list-group p-0">
                            <!-- ko foreach: FishingController.getFishablePokemon() -->
                            <li class="list-group-item list-group-item-action seed-list-item p-2">
                                <img src="" height="28px"
                                    data-bind="attr:{ src: FishingController.getPokemonImage($data) }">
                                <span data-bind="text: FishingController.getPokemonName($data)"></span>
                            </li>
                            <!-- /ko -->
                        </ul>
                    </div>
                    <div class="col-12 col-lg-8">
                        <div id="plotList" class="row" data-bind="foreach: App.game.fishing.FishPlot">
                            <!-- ko if: $index() % GameConstants.FARM_PLOT_WIDTH == 0 -->
                            <div class="w-100"></div>
                            <!-- /ko -->
                            <div class="plot col" data-bind="css: { plotLocked : !$data.isUnlocked }">
                                <div class="plot-content" data-bind="class: FarmController.calculateCssClass()">
                                    <div class="plotImage">
                                        <img style="width: 100%" src="assets/images/farm/soil.png"
                                            data-bind="class: FarmController.calcMulchClass($data)">
                                        <div class="plotButton"
                                            data-bind="
                                            click: function(){FishingController.plotClick($index())}">
                                            <img width="100%" height="100%" src=""
                                                style="width: 68.75%; max-height: 100%; image-rendering: pixelated;"
                                                data-bind="attr:{ src: FishingController.getImage($index())}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

    <script type="text/html" id="undergroundUpgradeTemplate">
        <td class='vertical-middle' data-bind='text: upgrade.displayName + ": " + totalBonus'></td>
        <td class='vertical-middle'
            data-bind='text: upgrade.isMaxLevel() ? "" : "(" + (upgrade.increasing ? "+" : "-") + upgrade.upgradeBonus() + ")"'></td>
        <td class='vertical-middle'
            data-bind='text: upgrade.isMaxLevel() ? "" : upgrade.calculateCost().amount + " diamonds"'></td>
        <td class='vertical-middle'>
            <button class='btn btn-success btn-block'
                    data-bind='css: { disabled: !upgrade.canBuy() },
                                text: upgrade.isMaxLevel() ? "Max" : "Upgrade",
                                click: function(){upgrade.buy(); DailyDeal.generateDeals(App.game.underground.getDailyDealsMax(), new Date());}'>
            </button>
        </td>
    </script>

    <script type="text/html" id="treasureListTemplate">
        <tr data-bind='if: amount() > 0'>
            <td class='vertical-middle'>
                <img class='mineInventoryItem' data-bind='attr:{ src: Underground.getMineItemById(id).image }'>
                <span data-bind='text: "("+$data.amount()+")"'></span>
            </td>
            <td class='vertical-middle' data-bind='text: name'></td>
            <!-- ko if: valueType == "Mine Egg" -->
            <td></td>
            <!-- /ko -->
            <!-- ko ifnot: valueType == "Mine Egg" -->
            <td class='vertical-middle' data-bind='text: value + " " + UndergroundItem.getFullResourceName(valueType, value)'></td>
            <!-- /ko -->
            <td class='vertical-middle'>
                <div class="btn-group btn-block" data-bind="let: { sellAmount: ko.observable(1) }">
                    <!-- ko ifnot: valueType == "Mine Egg" -->
                    <label
                    class="input-group-prepend btn btn-success active clickable m-0"
                        data-bind="text: sellLocked() ? 'ðŸ”’' : 'ðŸ”“', attr: { for: 'sellLockedIndicatorOfItem' + id }"
                    >ðŸ”“</label>
                    <input
                        class="hidden"
                        type="checkbox"
                        data-bind="checked: sellLocked(), attr: { id: 'sellLockedIndicatorOfItem' + id }, event: { change: function(){Underground.setSellLockOfMineItem(id, !sellLocked())} }"
                    />
                    <!-- /ko -->
                    <button class='btn btn-success btn-block'
                            data-bind="attr: { 'data-itemid': id },
                            css: { disabled: amount() <= 0 || sellLocked() || (valueType === 'Mine Egg' && !App.game.breeding.hasFreeEggSlot()) },
                                    text: valueType === 'Mine Egg' ? 'Breed' : 'Sell',
                                    click: function(){Underground.sellMineItem($element.dataset.itemid, sellAmount() || 1)}">
                    </button>
                    <!-- ko if: valueType !== 'Mine Egg' -->
                    <button type="button" data-bind="text: sellAmount() + '&nbsp;', css: { disabled: sellLocked() }" class="btn btn-success dropdown-toggle dropdown-toggle-split active" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    </button>
                    <div class="dropdown-menu" data-bind="foreach: [1, 10, 100, 1000, Infinity]">
                        <button class="dropdown-item" type="button" data-bind="click: function(){sellAmount($data)}, text: $data"></button>
                    </div>
                    <!-- /ko -->
                </div>
            </td>
        </tr>
    </script>
</div>

<div aria-labelledby="mineSellAllTreasuresModalLabel" class="modal fade noselect mt-5" id="mineSellAllTreasuresModal" role="dialog"
     style="cursor:default" tabindex="-1">
    <div class="modal-dialog modal-dialog-scrollable modal-sm" role="document" data-bind="let: { filteredMineInvetory: player.mineInventory().filter(t => t.amount() > 0 && t.valueType != 'Mine Egg') }">
        <div class="modal-content">
            <div class="modal-header d-block">
                <h4 class="mb-0">
                    Sell all selected treasures
                </h4>
                (<span data-bind="text: filteredMineInvetory.filter(t => !t.sellLocked()).length + ' of ' + filteredMineInvetory.length"></span>)
            </div>
            <div class="modal-body p-0">
                <table class="table table-sm table-hover table-striped m-0">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Cumulative Value</th>
                        </tr>
                    </thead>
                    <tbody data-bind="template: { name: 'cumulativeValueListTemplate', foreach: Object.keys(Underground.getCumulativeValues()).sort() }">
                    </tbody>
                </table>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn mr-auto btn-danger" data-bind="click: function(){Underground.sellAllMineItems()}">
                    <span>Confirm sell</span>
                </button>
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>

    <script type="text/html" id="cumulativeValueListTemplate">
        <tr data-bind="let: { valueType: $data, cumulativeValue: Underground.getCumulativeValues()[$data].cumulativeValue, imgSrc: Underground.getCumulativeValues()[$data].imgSrc }">
            <td>
                <img width="20px'" data-bind="attr: { src: imgSrc }">
            </td>
            <td>
                <span data-bind="text: cumulativeValue + ' ' + UndergroundItem.getFullResourceName(valueType, cumulativeValue)"></span>
            </td>
        </tr>
    </script>
</div>
